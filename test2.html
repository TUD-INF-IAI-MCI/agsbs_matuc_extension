<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AGSBS</title>
    <link rel="stylesheet" href="./style/taskbar.css">
    <!--HEAD_END-->
    <style>
        body,form {
            width: 100%;
        }
                #table {

                    table-layout: fixed;
                    width: 95%;
                }
            .row{
                /* display: table-row; */
                
                width: 100%;
                display:flex;
            }

            .cell{
                /* display: table-cell; */
                flex-basis: 100%;
                width:auto;
                font-weight:unset;
                white-space: pre-wrap;
            word-wrap: break-word;
            resize:vertical;
            min-height: 30px;
            resize: none;
            min-width: 1px;
            box-sizing: border-box;
            margin:4px;
            padding: 1px;
            overflow: hidden;
    }
    </style>
</head>

<body>
    <form>
        <input name="tableHeadCheckbox" id="tableHeadCheckbox" type="checkbox" onchange="tableHeaderToggle(this)">
        <label for="tableHeadCheckbox">${this._language.get("tableHeadCheckbox")}</label><br>
        <label for="tableType">${this._language.get("tableType")}</label><br>
        <select name='tableType' id='tableType'>
            <option value='simpleTable'>this._language.get("simpleTable")</option>
            <option value='pipeTable'>this._language.get("pipeTable")</option>
            <option value='gridTable'>this._language.get("gridTable")</option>
        </select><br>
        <label>this._language.get("rows")</label>
        <input type="number" name='rows' , id='rows' min="1" placeholder="1" value="1" onchange="onRowChange(this)">
        <label>this._language.get("columns")</label>
        <input type="number" name='columns' , id='columns' min="1" placeholder="1" value="1" onchange="onColumsChange(this)">
        <input type="hidden" value=`` name="tableJSON" id="tableJSON">

        <div id="table">
        </div>
        <script>
            var tableID = "table";
            var rowName = "Row";
            var colName = "Column";


            function getNumberTableColumns() {
                var table = document.getElementById(tableID);
                var rows = table.children;
                if (rows.length > 0) {
                    var firstrow = rows[0];
                    var tableCellsInFirstRow = firstrow.children;
                    return tableCellsInFirstRow.length;
                } else {
                    return 0;
                }
            }

            function getNumberTableRows() {
                var table = document.getElementById(tableID);
                var rows = table.children;
                return rows.length;
            }

            function addNewRow() {
                var table = document.getElementById(tableID);

                var columnsHtml = "";
                var rowNumber = getNumberTableRows();
                var newRowNumber = rowNumber + 1;
                var columnNumber = getNumberTableColumns();
                for (var i = 1; i <= columnNumber; i++) { //Generates Inputfields for the length of the row

                    columnsHtml += generateCell(newRowNumber, i);
                }
                if (columnNumber === 0) { //If Table is Empty
                    columnsHtml += generateCell(1, 1);
                }
                columnsHtml = generateRowWrapper(newRowNumber, columnsHtml);
                //table.innerHTML = table.innerHTML + columnsHtml
                table.insertAdjacentHTML('beforeend', columnsHtml);
                if (columnNumber === 0) { //If Table is Empty
                    changedCell(); //To generate new JSON
                }
            }

            function generateRowWrapper(rownumber, innerHTML) { //Wrapper arround the content of the new row 
                return '<div class="row" datarow="' + rownumber + '">' + innerHTML + '</div>';
            }

            function generateCell(r, c) {
                var placeholder = generatePlaceholder(r, c);
                return '<textarea class="cell" placeholder="' + placeholder + '" datarow="' + r +
                    '" datacolumn="' + c + '" onkeyup="changedCell()"></textarea>';
            }

            function generatePlaceholder(r, c) { //Is used by generateCell, what content is displayed as placeholder
                return rowName + " " + r + " " + colName + " " + c;
            }

            function addNewColumn() {
                var table = document.getElementById(tableID);
                var rows = table.children;
                var rowNumbers = getNumberTableRows();
                var colNumbers = getNumberTableColumns();
                if (rowNumbers > 0) {
                    for (var i = 0; i < rowNumbers; i++) {
                        var thisRow = rows[i];
                        var newCellHTML = generateCell(i + 1, colNumbers + 1); //i+1 because the array of the rows array starts at 0
                        thisRow.insertAdjacentHTML('beforeend', newCellHTML);
                    }
                }
            }

            function removeLastRow() {
                var table = document.getElementById(tableID);
                table.removeChild(table.lastChild);
            }

            function removeLastColumn() {
                var table = document.getElementById(tableID);
                var rows = table.children;
                var rowNumber = getNumberTableRows();
                for (var i = 0; i < rowNumber; i++) {
                    var thisRow = rows[i];
                    thisRow.removeChild(thisRow.lastChild);
                }
            }

            function onColumsChange(e) {
                var number = e.value;
                var numberColumns = getNumberTableColumns();
                if (number > 0) {
                    while (number > numberColumns) {
                        addNewColumn();
                        numberColumns += 1;
                    }
                    while (number < numberColumns) {
                        removeLastColumn();
                        numberColumns -= 1;
                    }
                }
                changedCell(); //To generate new JSON
            }


            function onRowChange(e) {
                var number = e.value;
                var numberRows = getNumberTableRows();
                if (number > 0) {
                    while (number > numberRows) {
                        addNewRow();
                        numberRows += 1;
                    }
                    while (number < numberRows) {
                        removeLastRow();
                        numberRows -= 1;
                    }
                }
                changedCell(); //To generate new JSON
            }
            addNewRow(); //To insert first Element

            function tableHeaderToggle(element) {
                var table = document.getElementById(tableID);
                if (table.childElementCount > 0) {
                    var rows = table.children;
                    var firstRow = rows[0];
                    var styleToSet = "";
                    console.log(element.checked);
                    if (element.checked == true) {
                        styleToSet = "bold";
                    } else {
                        styleToSet = "unset";
                    }
                    firstRow.style.fontWeight = styleToSet;
                }
            }

            async function changedCell() {
                var tableObject = [];
                var table = document.getElementById(tableID);
                if (table.childElementCount > 0) {
                    var rows = table.children;
                    for (var i = 0; i < rows.length; i++) { //For each Row
                        var thisRow = rows[i];
                        if (thisRow.childElementCount > 0) {
                            var thisRowsCells = thisRow.children;
                            for (var j = 0; j < thisRowsCells.length; j++) { //For each Cell in a Row
                                if (j === 0) {
                                    tableObject[i] = [];
                                }
                                var thisCell = thisRowsCells[j];
                                var thisCellsValue = thisCell.value;
                                tableObject[i][j] = thisCellsValue;
                                adaptCellHeight(thisCell);

                            }
                        }
                    }
                }
                var tableJSON = document.getElementById("tableJSON");
                tableJSON.value = JSON.stringify(tableObject);
            }
            async function adaptCellHeight(cell) {
                cell.style.height = (cell.scrollHeight) + "px";
            }
        </script>
        <script>
            var jsonString =`
            {"hasHeader":true,"tableType":"SIMPLE","data":[["B\\nC","V"],["f","*"]]}`;
            var tableHeadCheckboxText = "tableHeadCheckbox";
            var tableTypeSelector = "tableType";
            var tableTypeText = [];
            tableTypeText["GRID"] = "gridTable";
            tableTypeText["PIPE"] = "pipeTable";
            tableTypeText["SIMPLE"] = "simpleTable";
            var rowsSelectorName = "rows";
            var columnsSelectorName = "columns";
            var tableBoxName = "table";
            function genCell () {
               
            }
            function loadJSON(){
                var escapedJSONString = jsonString.replace(/\\\\n/g, "\n")
                .replace(/\\\\'/g, "\'")
                .replace(/\\\\"/g, '\"')
                .replace(/\\\\&/g, "\&")
                .replace(/\\\\r/g, "\r")
                .replace(/\\\\t/g, "\t")
                .replace(/\\\\b/g, "\b")
                .replace(/\\\\f/g, "\f");
                var json = JSON.parse(escapedJSONString);
                console.log("backlacsh" + jsonString.includes("\\n"));
                console.log("backlach" + jsonString.includes("\n"));
                //var json = JSON.parse(jsonString);
                console.log(json);
                return json;
            }
            async function loadIntoForm(json){
                var headerCheckbox =  document.getElementById(tableHeadCheckboxText);
                if(json.hasHeader === true){
                   headerCheckbox.checked = true;
                } else {
                    headerCheckbox.checked = false;
                }
                var thisTableType = tableTypeText[json.tableType];
                if(thisTableType!== undefined && thisTableType!==""){
                var thistableTypeSelector = document.getElementById(tableTypeSelector);
                thistableTypeSelector.value = thisTableType;
                }
                var rowsSelector = document.getElementById(rowsSelectorName);
                var colSelector = document.getElementById(columnsSelectorName);
                var rowNumber = json["data"].length;
                var colNumber = json["data"][0].length;
                if(rowNumber === undefined || rowNumber===null){
                    return false;
                }
                if(colNumber === undefined || colNumber===null){
                    return false;
                }
                console.log(rowNumber,colNumber);
                rowsSelector.value = rowNumber;
                onRowChange(rowsSelector); //call to other scriptblock from the normal insert table script.
                colSelector.value = colNumber;
                onColumsChange(colSelector); //call to other scriptblock from the normal insert table script.
                
                loadCellsWithContent(json["data"]);
            }

            function loadCellsWithContent (data){
                console.log(data);
                var table = document.getElementById(tableBoxName);
                var rows = table.children;
                console.log(rows);
                for (var i=0;i<rows.length;i++){
                    var thisRow = rows[i];
                    var thisJSONRow = data[i];
                    var thisCols = thisRow.children;
                    console.log(thisRow);
                    for (var j = 0;j<thisCols.length;j++){
                        
                        var thisCell = thisCols[j];
                        var thisJSONCell = thisJSONRow[j];
                        console.log(thisCell,thisJSONCell);
                        thisCell.value = thisJSONCell;
                        changedCell(); //Call to update the hidden form
                    }
                }
            }

            window.onload = async function(){
                document.body.innerHTML ="LOADED"+ document.body.innerHTML;
                var parsedJSON = loadJSON();
                loadIntoForm(parsedJSON);

            }
        </script>



    </form>
</body>

</html>
<!--
    background-color: rgb(60, 60, 60);
    color: rgb(240, 240, 240);
    border-color: rgb(60, 60, 60);
}
workbench.main.css:14
.monaco-workbench .panel .monaco-action-bar .action-item .monaco-select-box {
    cursor: pointer;
    min-width: 110px;
    margin-right: 10px;
}
workbench.main.css:14
.monaco-shell select {
    font-family: inherit;
}
workbench.main.css:14
.monaco-select-box {
    width: 100%;
}
user agent stylesheet
select:not(:-internal-list-box) {
    overflow: visible !important;
}
user agent stylesheet
select, input[type="color" i][list] {
    background-color: rgb(248, 248, 248);
    border-width: 1px;
    border-style: solid;
    border-color: rgb(166, 166, 166);
    border-image: initial;
}
user agent stylesheet
select {
    -webkit-appearance: menulist;
    box-sizing: border-box;
    align-items: center;
    white-space: pre;
    -webkit-rtl-ordering: logical;
    color: black;
    background-color: white;
    cursor: default;
    border-width: 1px;
    border-style: solid;
    border-color: initial;
    border-image: initial;
}
user agent stylesheet
select {
    border-radius: 5px;
}
user agent stylesheet
input, textarea, select, button {
    text-rendering: auto;
    color: initial;
    letter-spacing: normal;
    word-spacing: normal;
    text-transform: none;
    text-indent: 0px;
    text-shadow: none;
    display: inline-block;
    text-align: start;
    margin: 0em;
    font: 11px system-ui;
}
user agent stylesheet
input, textarea, select, button, meter, progress {
    -webkit-writing-mode: horizontal-tb;
}
Inherited from li.action-item.select-container
workbench.main.css:14
.monaco-workbench .panel .monaco-action-bar .action-item.select-container {
    cursor: default;
}
workbench.main.css:3
.monaco-action-bar .action-item {
    cursor: pointer;
    display: inline-block;
    transition: transform 50ms ease;
    position: relative;
}
user agent stylesheet
li {
    display: list-item;
    text-align: -webkit-match-parent;
}
Inherited from ul.actions-container
user agent stylesheet
ul, menu, dir {
    display: block;
    list-style-type: disc;
    -webkit-margin-before: 1em;
    -webkit-margin-after: 1em;
    -webkit-margin-start: 0px;
    -webkit-margin-end: 0px;
    -webkit-padding-start: 40px;
}
Inherited from div.monaco-action-bar.animated
workbench.main.css:3
.monaco-action-bar {
    text-align: right;
    overflow: hidden;
    white-space: nowrap;
}
Inherited from div#workbench.main.container.monaco-workbench.mac
workbench.main.css:14
.monaco-workbench {
    font-size: 13px;
    line-height: 1.4em;
    position: relative;
    z-index: 1;
    overflow: hidden;
}
Inherited from body.monaco-shell.vs-dark.vscode-theme-defaults-themes-dark_plus-json.file-icons-enabled
<style>…</style>
.monaco-shell {
    color: #cccccc;
}
workbench.main.css:14
.monaco-shell, .monaco-shell .monaco-menu-container .monaco-menu {
    font-family: -apple-system,BlinkMacSystemFont,Segoe WPC,Segoe UI,HelveticaNeue-Light,Ubuntu,Droid Sans,sans-serif;
}
workbench.main.css:14
.monaco-shell {
    height: 100%;
    width: 100%;
    margin: 0;
    padding: 0;
    overflow: hidden;
    font-size: 11px;
    user-select: none;
}

---------------------------------------------



    user-select: none;

    list-style-type: disc;

    -webkit-writing-mode: horizontal-tb;

    text-rendering: auto;
    letter-spacing: normal;
    word-spacing: normal;
    text-transform: none;
    text-indent: 0px;
    text-shadow: none;
    display: inline-block;
    text-align: start;
    margin: 0em;
    font: 11px system-ui;

    border-radius: 5px;

    -webkit-appearance: menulist;
    box-sizing: border-box;
    align-items: center;
    white-space: pre;
    -webkit-rtl-ordering: logical;
    border-width: 1px;
    border-style: solid;
    border-image: initial;

    width: 100%;

    font-family: inherit;

    cursor: pointer;
    min-width: 110px;
    margin-right: 10px;

    background-color: rgb(60, 60, 60);
    color: rgb(240, 240, 240);
    border-color: rgb(60, 60, 60);

select:not(:-internal-list-box) {
    overflow: visible !important;
}

-->